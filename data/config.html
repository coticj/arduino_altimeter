<html>
<head>
    <title>Logger</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <script type="text/javascript" src="jquery-3.2.1.min.js"></script>
    <script type="text/javascript">

        function getCss() {
            $.ajax({
                url: "css.css",
                dataType: "text",
                success: function (data) {
                    $("head").append("<style type='text/css'>" + data + "</style>");
                    console.log("css.css loaded");
                    getSvg();
                }
            });
        }

        function getSvg() {
            $.ajax({
                url: "defs.svg",
                dataType: "text",
                success: function (data) {
                    $("head").append(data);
                    console.log("defs.svg loaded");
                    getFn();
                }
            });
        }

        function getFn() {
            $.getScript("fn.js").done(function (script, textStatus) {
                console.log("fn.js loaded");
                getLocation();
            });
        }

        function getLocation() {
            $.getJSON("location.txt", function (data) {
                console.log("location.txt loaded");
                $.each(data, function (index, item) {
                    $('#location').append(
                        $('<option></option>').val(item).html(item)
                    );
                });
            }).done(function (data) {
                getAircraft();
            });
        }

        function getAircraft() {
            $.getJSON("aircraft.txt", function (data) {
                console.log("aircraft.txt loaded");
                $.each(data, function (index, item) {
                    $('#aircraft').append(
                        $('<option></option>').val(item).html(item)
                    );
                });
            }).done(function (data) {
                fillValues();
            });
        }

        function fillValues() {
            $.getJSON("/getConfig").done(function (data) {
                console.log("/getConfig loaded");
                $('#ssid').val(data.ssid);
                $('#password').val(data.password);
                $('#lastJump').val(data.lastJump);
                $("#location").val(data.location).change();
                $("#aircraft").val(data.aircraft).change();
            });
        }

        $("#test").click(function (e) {
            e.preventDefault();
            $.get("/test", function (data) {
                alert("LED test was performed.");
            });
        });

        $("#restart").click(function (e) {
            e.preventDefault();
            $.get("/restart", function (data) {
                alert("Restart was performed.");
            });
        });

        $("#clearLog").click(function (e) {
            e.preventDefault();
            var checkstr = confirm('Are you sure you want to clear the log?');
            if (checkstr == true) {
                $.get("/clearLogs", function (data) {
                    alert(data);
                });
            }
            else {
                return false;
            }
        });

        $(document).ready(function () {
            getCss();
        });
    </script>
</head>
<body>
    <div id="head">
        <button type="button" class="icon" onclick="goTo('index.html')">
            <svg width="25" height="25">
                <use xlink:href="#icon-home"></use>
            </svg>
        </button>
        <button type="button" class="icon" onclick="goTo('log.html')">
            <svg width="25" height="25">
                <use xlink:href="#icon-book"></use>
            </svg>
        </button>
    </div>
    <form action="/updateConfig" method="post">
        <table class="padded">
            <tr>
                <td>
                    <b>SSID:</b>
                </td>
                <td>
                    <input type="text" id="ssid" name="ssid" value="">
                </td>
            </tr>
            <tr>
                <td>
                    <b>WIFI Password:</b>
                </td>
                <td>
                    <input type="text" id="password" name="password" value="">
                </td>
            </tr>
            <tr>
                <td>
                    <b>Location:</b>
                </td>
                <td>
                    <select id="location" name="location"></select>
                </td>
            </tr>
            <tr>
                <td>
                    <b>Aircraft:</b>
                </td>
                <td>
                    <select id="aircraft" name="aircraft"></select>
                </td>
            </tr>
            <tr>
                <td>
                    <b>Last jump:</b>
                </td>
                <td>
                    <input type="number" id="lastJump" name="lastJump" value="">
                </td>
            </tr>

            <tr>
                <td></td>
                <td>
                    <button type="submit">Save</button>
                </td>
            </tr>
        </table>
    </form>
    <div id="foot">
        <div class="buttons-vertical">
            <button type="button" id="test">Test LED strip</button>
            <button type="button" id="restart">Restart logger</button>
            <button type="button" id="clearLog">Clear log</button>
        </div>
    </div>
</body>
</html>